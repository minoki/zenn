---
title: "UTF-8ã®ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã¨ã‚ªãƒ¼ãƒˆãƒžãƒˆãƒ³"
emoji: "ðŸ‘Œ"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: [unicode, utf8]
published: true
---

UTF-8ã¯ä»Šæ—¥ã®æ–‡å­—ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã®ä¸­ã§æœ€ã‚‚é‡è¦ãªã‚‚ã®ã¨è¨€ã£ã¦å·®ã—æ”¯ãˆãªã„ã§ã—ã‚‡ã†ã€‚UTF-8ã®ä»•æ§˜ã¯ã“ã®è¾ºã§ç¢ºèªã§ãã¾ã™ï¼š

* [Unicode 15.1.0](https://www.unicode.org/versions/Unicode15.1.0/) &gt; 3.9 UTF-8
* [RFC 3629 - UTF-8, a transformation format of ISO 10646](https://datatracker.ietf.org/doc/html/rfc3629)

ã“ã®è¨˜äº‹ã§ã¯ã€èª­è€…ã¯ã™ã§ã«UTF-8ã«ã‚ã‚‹ç¨‹åº¦ã®é¦´æŸ“ã¿ãŒã‚ã‚‹ã‚‚ã®ã¨ã—ã¦ã€UTF-8ã®ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã®ç´°ã‹ã„ã¨ã“ã‚ã‚’è€ƒãˆã¾ã™ã€‚

UTF-8ã®ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’è¡Œã†ã«ã¯ã€ä»¥ä¸‹ã®ã“ã¨ã‚’ç¢ºã‹ã‚ãªã‘ã‚Œã°ãªã‚Šã¾ã›ã‚“ï¼š

* æœ€åˆã®1ãƒã‚¤ãƒˆãŒæ‰€å®šã®ç¯„å›²ã«ã‚ã‚‹ã“ã¨ï¼šASCII (0x00-0x7F) ã¾ãŸã¯0xC2ä»¥ä¸Šã€‚
* å¾Œç¶šã®ãƒã‚¤ãƒˆï¼ˆãŸã¡ï¼‰ãŒ0x80-0xBFã®ç¯„å›²ã«ã‚ã‚‹ã“ã¨ã€‚
* é•·ã™ãŽãªã„ã“ã¨ï¼šU+007Fä»¥ä¸‹ã®æ–‡å­—ã¯ã¡ã‚‡ã†ã©1ãƒã‚¤ãƒˆã§è¡¨ç¾ã•ã‚Œã¦ã„ã‚‹ã“ã¨ã€U+0080ä»¥ä¸ŠU+07FFä»¥ä¸‹ã®æ–‡å­—ã¯ã¡ã‚‡ã†ã©2ãƒã‚¤ãƒˆã§è¡¨ç¾ã•ã‚Œã¦ã„ã‚‹ã“ã¨ã€U+0800ä»¥ä¸ŠU+FFFFä»¥ä¸‹ã®æ–‡å­—ã¯ã¡ã‚‡ã†ã©3ãƒã‚¤ãƒˆã§è¡¨ç¾ã•ã‚Œã¦ã„ã‚‹ã“ã¨ã€U+10000ä»¥ä¸ŠU+10FFFFä»¥ä¸‹ã®æ–‡å­—ã¯ã¡ã‚‡ã†ã©4ãƒã‚¤ãƒˆã§è¡¨ç¾ã•ã‚Œã¦ã„ã‚‹ã“ã¨ã€‚
* Unicodeã‚¹ã‚«ãƒ©ãƒ¼å€¤ã¨ã—ã¦æ­£å½“ãªæ–‡å­—ã‚’è¡¨ç¾ã—ã¦ã„ã‚‹ã“ã¨ï¼šã‚µãƒ­ã‚²ãƒ¼ãƒˆï¼ˆU+D800ä»¥ä¸ŠU+DFFFä»¥ä¸‹ï¼‰ã‚„ã€U+110000ä»¥ä¸Šã®å€¤ã‚’ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ã—ãªã„ã“ã¨ã€‚
    * å½“åˆã®UTF-8ã§ã¯31ãƒ“ãƒƒãƒˆï¼ˆU+7FFFFFFFã¾ã§ï¼‰è¡¨ç¾ã§ãã¾ã—ãŸãŒã€ãã®å¾Œç¸®å°ã•ã‚Œã¾ã—ãŸã€‚

ã¤ã¾ã‚Šã€UTF-8ã®1æ–‡å­—ã«ç›¸å½“ã™ã‚‹ãƒ‘ã‚¿ãƒ¼ãƒ³ã¯ç´ æœ´ã«è€ƒãˆã‚‹ã¨

```
0x00-0x7F
0xC0-0xDF 0x80-0xBF                      (0b110a aaaa  0b10bb bbbb)
0xE0-0xEF 0x80-0xBF 0x80-0xBF            (0b1110 aaaa  0b10bb bbbb  0b10cc cccc)
0xF0-0xF7 0x80-0xBF 0x80-0xBF 0x80-0xBF  (0b1111 0aaa  0b10bb bbbb  0b10cc cccc  0b10dd dddd)
```

ã§ã™ãŒã€ã“ã®ãƒ‘ã‚¿ãƒ¼ãƒ³ã§ã¯ç·©ã™ãŽã¦ã€ä¸æ­£ãªUTF-8ã‚’å—ã‘ä»˜ã‘ã¦ã—ã¾ã†ã®ã§ã™ã€‚

ã“ã®ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’ã©ã†æ”¹è‰¯ã™ã‚Œã°è‰¯ã„ã®ã‹ã€è¦‹ã¦ã„ãã¾ã™ã€‚çµæžœã ã‘çŸ¥ã‚ŠãŸã„äººã¯ã€Œã¾ã¨ã‚ã€ã«é£›ã¶ã‹ã€Unicodeã®è¦æ ¼ãªã‚ŠRFC 3629ãªã‚Šã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚

## 2ãƒã‚¤ãƒˆã®ã‚±ãƒ¼ã‚¹

2ãƒã‚¤ãƒˆã®ã‚±ãƒ¼ã‚¹ã§ã¯11ãƒ“ãƒƒãƒˆã€ã¤ã¾ã‚ŠU+07FFã¾ã§ã‚’è¡¨ç¾ã§ãã¾ã™ã€‚ã—ã‹ã—ã€U+007Fä»¥ä¸‹ã®æ–‡å­—ã¯1ãƒã‚¤ãƒˆã§ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ã—ãªãã¦ã¯ãªã‚‰ãªã„ãŸã‚ã€ãã‚Œã‚‰ã«ç›¸å½“ã™ã‚‹2ãƒã‚¤ãƒˆã®ãƒ‘ã‚¿ãƒ¼ãƒ³ã¯ä¸æ­£ã¨ãªã‚Šã¾ã™ã€‚

U+0080ã«ç›¸å½“ã™ã‚‹è¡¨ç¾ã¯

```
0xC2 0x80  (0b1100 0010  0b1000 0000)
```

ãªã®ã§ã€2ãƒã‚¤ãƒˆã®å ´åˆã¯ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ã•ã‚ŒãŸã‚‚ã®ãŒã“ã‚Œä»¥ä¸Šãªã‚‰å•é¡Œã‚ã‚Šã¾ã›ã‚“ã€‚ã¤ã¾ã‚Šã€æ­£ã—ã„2ãƒã‚¤ãƒˆã®ãƒ‘ã‚¿ãƒ¼ãƒ³ã¯

```
0xC2-0xDF 0x80-BF
```

ã¨ãªã‚Šã¾ã™ã€‚

## 3ãƒã‚¤ãƒˆã®ã‚±ãƒ¼ã‚¹

3ãƒã‚¤ãƒˆã®ã‚±ãƒ¼ã‚¹ã§ã¯16ãƒ“ãƒƒãƒˆã€ã¤ã¾ã‚ŠU+FFFFã¾ã§ã‚’è¡¨ç¾ã§ãã¾ã™ã€‚ã—ã‹ã—ã€U+07FFä»¥ä¸‹ã®æ–‡å­—ã¯2ãƒã‚¤ãƒˆä»¥ä¸‹ã§ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ã—ãªãã¦ã¯ãªã‚‰ãªã„ã®ã§ã€ãã‚Œã‚‰ã«ç›¸å½“ã™ã‚‹3ãƒã‚¤ãƒˆã®ãƒ‘ã‚¿ãƒ¼ãƒ³ã¯ä¸æ­£ã¨ãªã‚Šã¾ã™ã€‚

ã¾ãŸã€U+D800ä»¥ä¸ŠU+DFFFä»¥ä¸‹ã®ã‚’è¡¨ç¾ã™ã‚‹ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚‚ä¸æ­£ã¨ãªã‚Šã¾ã™ã€‚

U+0800ã«ç›¸å½“ã™ã‚‹è¡¨ç¾ã¯

```
0xE0 0xA0 0x80  (0b1110 0000  0b1010 0000  0b1000 0000)
```

U+D7FFã«ç›¸å½“ã™ã‚‹è¡¨ç¾ã¯

```
0xED 0x9F 0xBF  (0b1110 1101  0b1001 1111  0b1011 1111)
```

U+D800ã«ç›¸å½“ã™ã‚‹è¡¨ç¾ã¯

```
0xED 0xA0 0x80  (0b1110 1101  0b1010 0000  0b1000 0000)
```

U+DFFFã«ç›¸å½“ã™ã‚‹è¡¨ç¾ã¯

```
0xED 0xBF 0xBF  (0b1110 1101  0b1011 1111  0b1011 1111)
```

U+E000ã«ç›¸å½“ã™ã‚‹è¡¨ç¾ã¯

```
0xEE 0x80 0x80  (0b1110 1110  0b1000 0000  0b1000 0000)
```

ã¨ãªã‚Šã¾ã™ã€‚è¤‡é›‘ãªã®ã§ã€ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’è¨˜è¿°ã™ã‚‹ä¸Šã§ã¯1ãƒã‚¤ãƒˆç›®ã§åˆ†å²ã™ã‚‹ã®ãŒè‰¯ã„ã§ã—ã‚‡ã†ã€‚

```
0xE0      0xA0-0xBF 0x80-0xBF
0xE1-0xEC 0x80-0xBF 0x80-0xBF
0xED      0x80-0x9F 0x80-0xBF
0xEE-0xEF 0x80-0xBF 0x80-0xBF
```

## 4ãƒã‚¤ãƒˆã®ã‚±ãƒ¼ã‚¹

4ãƒã‚¤ãƒˆã®ã‚±ãƒ¼ã‚¹ã§ã¯21ãƒ“ãƒƒãƒˆã€ã¤ã¾ã‚ŠU+1FFFFFã¾ã§ã‚’è¡¨ç¾ã§ãã¾ã™ã€‚ã—ã‹ã—ã€U+FFFFä»¥ä¸‹ã®æ–‡å­—ã¯3ãƒã‚¤ãƒˆä»¥ä¸‹ã§ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ã—ãªãã¦ã¯ãªã‚‰ãªã„ã®ã§ã€ãã‚Œã‚‰ã«ç›¸å½“ã™ã‚‹4ãƒã‚¤ãƒˆã®ãƒ‘ã‚¿ãƒ¼ãƒ³ã¯ä¸æ­£ã¨ãªã‚Šã¾ã™ã€‚

ã¾ãŸã€U+110000ä»¥ä¸Šã®è¡¨ç¾ã™ã‚‹ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚‚ä¸æ­£ã¨ãªã‚Šã¾ã™ã€‚

U+10000ã«ç›¸å½“ã™ã‚‹è¡¨ç¾ã¯

```
0xF0 0x90 0x80 0x80  (0b1111 0000  0b1001 0000  0b1000 0000  0b1000 0000)
```

U+10FFFFã«ç›¸å½“ã™ã‚‹è¡¨ç¾ã¯

```
0xF4 0x8F 0xBF 0xBF  (0b1111 0100  0b1000 1111  0b1011 1111  0b1011 1111)
```

ãªã®ã§ã€4ãƒã‚¤ãƒˆã®æ­£ã—ã„ãƒ‘ã‚¿ãƒ¼ãƒ³ã¯æ¬¡ã®ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚

```
0xF0      0x90-0xBF 0x80-0xBF 0x80-0xBF
0xF1-0xF3 0x80-0xBF 0x80-0xBF 0x80-0xBF
0xF4      0x80-0x8F 0x80-0xBF 0x80-0xBF
```

## ã¾ã¨ã‚

æ­£ã—ãUTF-8ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ã•ã‚ŒãŸæ–‡å­—ã¯æ¬¡ã®å½¢ã‚’ã—ã¦ãŠã‚Šã€é€†ã«æ¬¡ã®å½¢ã®ãƒã‚¤ãƒˆåˆ—ã¯æ­£ã—ãã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ã•ã‚ŒãŸUTF-8ã§ã™ã€‚

```
0x00-0x7F
0xC2-0xDF 0x80-BF
0xE0      0xA0-0xBF 0x80-0xBF
0xE1-0xEC 0x80-0xBF 0x80-0xBF
0xED      0x80-0x9F 0x80-0xBF
0xEE-0xEF 0x80-0xBF 0x80-0xBF
0xF0      0x90-0xBF 0x80-0xBF 0x80-0xBF
0xF1-0xF3 0x80-0xBF 0x80-0xBF 0x80-0xBF
0xF4      0x80-0x8F 0x80-0xBF 0x80-0xBF
```

## æœ‰é™çŠ¶æ…‹æ©Ÿæ¢°ã§ã®è¡¨ç¾

æœ‰é™çŠ¶æ…‹æ©Ÿæ¢°ã¨ã—ã¦ã¯ã€8ã¤ã®çŠ¶æ…‹ã§è¡¨ç¾ã§ãã¾ã™ï¼š

```mermaid
stateDiagram
    START --> START: 0x00-0x7F
    START --> TAILx1: 0xC2-0xDF
    TAILx1 --> START: 0x80-0xBF
    START --> A: 0xE0
    A --> TAILx1: 0xA0-0xBF
    START --> TAILx2: 0xE1-0xEC, 0xEE-0xEF
    TAILx2 --> TAILx1: 0x80-0xBF
    START --> B: 0xED
    B --> TAILx1: 0x80-0x9F
    START --> C: 0xF0
    C --> TAILx2: 0x90-0xBF
    START --> TAILx3: 0xF1-0xF3
    TAILx3 --> TAILx2: 0x80-0xBF
    START --> D: 0xF4
    D --> TAILx2: 0x80-0x8F
```

å„ãƒã‚¤ãƒˆãŒã©ã®é·ç§»ã‚’å¼•ãèµ·ã“ã™ã‹ã‚‚æ›¸ã„ã¦ãŠãã¾ã™:

```
0x00-0x7F: START --> START
0x80-0x8F: TAILx1 --> START
           TAILx2 --> TAILx1
           TAILx3 --> TAILx2
           B --> TAILx1
           D --> TAILx2
0x90-0x9F: TAILx1 --> START
           TAILx2 --> TAILx1
           TAILx3 --> TAILx2
           B --> TAILx1
           C --> TAILx2
0xA0-0xBF: TAILx1 --> START
           TAILx2 --> TAILx1
           TAILx3 --> TAILx2
           A --> TAILx1
           C --> TAILx2
0xC2-0xDF: START --> TAILx1
0xE0:      START --> A
0xE1-0xEC: START --> TAILx2
0xED:      START --> B
0xEE-0xEF: START --> TAILx2
0xF0:      START --> C
0xF1-0xF3: START --> TAILx3
0xF4:      START --> D
```
